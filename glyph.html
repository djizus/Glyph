<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="black.css" />
    <script type="text/javascript" src="glyph-tools.js" charset="utf-8"></script>
    <script type="text/javascript" src="glyph-dic.js" charset="utf-8"></script>
    <script type="text/javascript" src="glyph-sequence-dic.js" charset="utf-8"></script>
    <script type="text/javascript" src="glyph-game.js" charset="utf-8"></script>
    <title>Glyph Helper - Sequence Finder </title>
  </head>
  <body>
    <div id="list-page">
      <a href="#">Glyph Helper</a>
      <script>
      //<![CDATA[
		  
	  (	
		function(){
          var gm9igt = gm9.IngressGlyphTools;
          var page = document.getElementById("list-page");
          var lv;
          var naviDiv = document.createElement("div");
		  naviDiv.setAttribute("id", "divMain");
		  naviDiv.style.float = "left";
		  naviDiv.style.width = "50%";
		  naviDiv.style.margin = "2.5% 1.5%"; 
          page.appendChild(naviDiv);
		  
		  var q = "<h2> Query </h2>";
		  naviDiv.innerHTML = naviDiv.innerHTML + q;
		  var newDiv = document.createElement('div');
		  newDiv.style.margin = "0 0 2% 0";
			var selectHTML = "";
			selectHTML="<br/><select id='sel1' onchange='displayLvl()'>";
			for(lv = 0; lv <= 8; ++lv){
				selectHTML+= "<option value='"+lv+"'>LV"+lv+"</option>";
			}
			selectHTML += "</select>";
			newDiv.innerHTML = selectHTML;
			naviDiv.appendChild(newDiv);
			
			var glyphPad = gm9igt.createInputPad({
			size: 300,
			style: {
			  color: "white"
			}
		  });
		  
		  var pad = document.createElement('div');
		  pad.setAttribute("id", "glyph-pad");	  
		  pad.appendChild(glyphPad);
		  naviDiv.appendChild(pad);
		  glyphPad.addEventListener("glyphchange", function(e){
			var glyph = glyphPad.getGlyph();
			glyphWord.value = gm9igt.glyphtionary.get(glyph);
		  }, false);
		  
		  //glyphPad.setGlyph((gm9igt.glyphtionaryIndex["shapers"] || [null])[0]);
		  
		  var c = document.createElement('div');
		  c.setAttribute("id", "control");
		  c.innerHTML = "<br/>Word:   <input type='text' id='glyph-word' />         ";
			
		var bWord = document.createElement("input");
		  bWord.type = "button";
		  bWord.value = "Set";
		  bWord.addEventListener("click", function(e){
			  setGlyphFromWord(glyphWord.value);
		  }, false);
		 c.appendChild(bWord);
		 
		 var bClear = document.createElement("input");
		  bClear.type = "button";
		  bClear.value = "Clear";
		  bClear.addEventListener("click", function(e){
			  glyphPad.clearGlyph();
		  }, false);
		 c.appendChild(bClear);
		 
		 var bFinder = document.createElement("input");
		  bFinder.type = "button";
		  bFinder.value = "Find Sequence";
		  bFinder.addEventListener("click", function(e){
			  findSequence();
		  }, false);
		 c.appendChild(bFinder);
		 
		  naviDiv.appendChild(c);
		
		var glyphWord = document.getElementById("glyph-word");
			
		  function setGlyphFromWord(word){
			  glyphPad.setGlyph((gm9igt.glyphtionaryIndex[word.toLowerCase()] || [null])[0]);
		  }
	  
	  //----------------------------------------------------------------//
		  
          for(lv = 0; lv <= 8; ++lv){		
		  var divs = document.createElement('div');
		  divs.setAttribute("id", "DivLV"+lv);
		  divs.style.display='none';
		  naviDiv.style.float = "left";
		  naviDiv.style.width = "50%";
		  var ans = "<h2> Glyphs by LVL </h2>";
		  divs.innerHTML = divs.innerHTML + ans;	
              // Level Header
              var levelHeader = document.createElement("h2");
              levelHeader.id = "level" + lv;
              levelHeader.appendChild(document.createTextNode("Level" + lv));
              //page.appendChild(levelHeader);
			  divs.innerHTML = divs.innerHTML + levelHeader.innerHTML;

              // Level Sequences Table
              var seqs = gm9igt.sequenceDic.getSequences(lv);
              var seqsTable = document.createElement("table");
              seqsTable.setAttribute("border", "1");
              //page.appendChild(seqsTable);
			  divs.innerHTML = divs.innerHTML;	
				divs.appendChild(seqsTable);			  
			  page.appendChild(divs);
              for(var si = 0; si < seqs.length; ++si){
                  var seqWords = seqs[si];
                  var seqTr = document.createElement("tr");
                  seqsTable.appendChild(seqTr);

                  // Hack Button
                  function addHackButton(parent, seqWords, lv){
                      var button = document.createElement("input");
                      button.type = "button";
                      button.value = "Hack";
                      button.style.float = "right";
                      button.addEventListener("click", function(e){
                          hack(seqWords, lv);
                      }, false);
                      parent.appendChild(button);
                  }

                  // Sequence Glyphs
                  var seqTd = document.createElement("td");
                  seqTr.appendChild(seqTd);
                  addHackButton(seqTd, seqWords, lv);
                  for(var gi = 0; gi < seqWords.length; ++gi){
                      var word = seqWords[gi]; //NOTE: Uppercase or Lowercase
                      var glyphs = gm9igt.glyphtionaryIndex[word.toLowerCase()];
                      var glyph = glyphs && glyphs.length > 0 ? glyphs[0] : null;
                      var glyphDiv = document.createElement("div");
                      glyphDiv.style.display = "inline-block";
                      glyphDiv.style.textAlign = "center";
                      if(glyph){
                          glyphDiv.appendChild(gm9igt.createGlyphImage(
                              glyph,
                              24,
                              {color: "white", glyphLineWidth: 2}));
                      }
                      var wordDiv = document.createElement("div");
                      wordDiv.style.padding = "0 0.5em";
                      wordDiv.appendChild(document.createTextNode(word.toUpperCase()));
                      glyphDiv.appendChild(wordDiv);
                      seqTd.appendChild(glyphDiv);
                  }
              }
          }

          function hack(words, lv){
              var seq = getSequenceFromWords(words);
              if(!seq){
                  alert("Cannot resolve glyph sequence.");
                  return;
              }

              var scrollPos = {
                  x: document.documentElement.scrollLeft || document.body.scrollLeft,
                  y: document.documentElement.scrollTop || document.body.scrollTop
              };
              page.style.display = "none";


              var gameObj = gm9igt.glyphGame.createGame();
              document.body.appendChild(gameObj.element);
              var viewportController = gm9igt.controlViewportMetaElement(gameObj.element);
              gameObj.hack(seq,
                  gm9igt.glyphGame.getLevelTimeLimit(lv),
                  gm9igt.glyphGame.getLevelSpeedBonusTime(lv));

              gameObj.onEndGame = function(){
                  viewportController.cancel();
                  gameObj.element.parentNode.removeChild(gameObj.element);
                  page.style.display = "";
                  window.scrollTo(scrollPos.x, scrollPos.y);
              };
          }

      })();
      //]]>
      </script>
    </div>
  </body>
</html>
